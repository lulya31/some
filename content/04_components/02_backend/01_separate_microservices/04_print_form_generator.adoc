---
title: "Генератор печатных форм"
description: "Генератор печатных форм"
weight: 4
draft: false
Categories:
    - Architecture
    - Backend    
Tags:
    - Services
    - Генератор печатных форм
---

:imgdir: /02_02_01_04_img/
:imagesoutdir: ./static/02_02_01_04_img/

include::static/includes/init.adoc[]

= Генератор печатных форм

== Общее описание сервиса

****
Генератор предназначен для формирования печатных форм документов в виде *PDF*-файла по заранее созданным шаблонам, а также для получения и сохранения подписанных и отсканированных копий документов. Генератор также позволяет администраторам создавать новые, изменять и удалять существующие шаблоны печатных форм.
****

.*Основные характеристики:*
****
. Генератор построен на базе *Node.js*
. В качестве базы данных используется отдельная БД *PostgreSQL*
. Для хранения отсканированных и подписанных документов используется *S3*-хранилище
. Все методы генератора работают по протоколу *REST*
. Шаблоны печатных форм представлены в виде редактируемого *HTML*-формата (*MVP*)
. Набор данных для заполнения ПФ поступают в формате *JSON*
****
****
На основе данной информации генерируется печатная форма (заполненный *PDF*-документ), которую требуется распечатать, подписать, сохранить в *1С:Документооборот* (для ряда документов) и внешнем хранилище *S3* (сохраняются все документы). +
Для анализа печатных форм используется отдельный сервис - *сервис анализа печатных форм*. +
Юридически значимые документы маркируются с помощью штрихкода *code-128*, в котором зашит *UUID* печатной формы.
****

*Также требуется реализовать:*
****
. Получение печатных форм по запросу
. Повторная печать формы уже существующей формы
. Редактирование шаблонов документов (не на этапе MVP)
****

== Принципиальная схема

****
.Схема взаимодействия основных компонент
[[main_scheme_anchor]]
[%collapsible%open]
====
image::main_scheme.png[title="Схема взаимодействия основных компонент", align=center]
====
****

****
.*Описание основных возможностей сервиса*
[cols="5,.^25,.^70"]
|===
^.^| № ^.^| Операция ^.^| Описание основных возможностей сервиса

| 1.1 | Формирование ПФ | Получение данных от клиента (приложения *НА*, *АСП*, *CRM*, *F&I*, *Сервис*) в формате *JSON*. На вход поступает наименование шаблона печатной формы и данные для заполнения шаблона, а также количество копий
| 1.2 | Формирование ПФ | Передача данных в *1С*:ДО для создания карточки документа и присвоения *GUID*
| 1.3 | Формирование ПФ | Метод возвращает ОК. если есть все необходимые поля. *GUID* будет возвращен в асинхронном режиме (отдельным методом)
| 1.4 | Формирование ПФ | Запрос *HTML*-шаблона документа печати в БД *PostgreSQL* по наименованию *HTML*-шаблона
| 1.5 | Формирование ПФ | Получение *HTML*-шаблона документа печати из БД *PostgreSQL*
| 1.6 | Формирование ПФ | Заполнение *HTML*-шаблона документа печати данными, полученными от клиента На шаблоне необходимо поместить *UUID* печатной формы в виде *Code-128*
| 1.7 | Формирование ПФ | Сохранение сформированной ПФ в *S3* в отдельном *Bucket*
| 1.8 | Формирование ПФ | Отправка заполненного *PDF*-документа в виде ссылке на *S3* и *UUID* ПФ клиенту для подписания
| 2.1 | Загрузка ПФ | Получение отсканированного и подписанного документа от клиента в виде PDF-файла
| 2.2-2.5 | Загрузка ПФ | Перед сохранением требуется выполнять проверку *Code-128* отсканированного документа и сравнивать его с данными уже имеющимися в БД c помощью сервиса анализа печатных форм
| 2.6 | Загрузка ПФ | Передача отсканированного файла в *1С* по протоколу *REST* (если необходимо). Файл передается в бинарном виде
| 2.7 | Загрузка ПФ | Сохранение отсканированного образа документа в виде *PDF*-файла на внешнем *S3* хранилище
| 2.8 | Загрузка ПФ | Обновление информации о статусе документа в *PostgreSQL*
| 2.9 | Загрузка ПФ | Вернуть статус запроса
| 2.10 | Загрузка ПФ | Вернуть результат клиенту
| 3.1 | Получение ПФ | Получение запроса на список ПФ или информации по одной ПФ
| 3.2 | Получение ПФ | Обращение в БД *PostgreSQL* для получения информации по ПФ
| 3.3 | Получение ПФ | Вернуть результаты обращения
| 3.4 | Получение ПФ | Проверка, что файл есть в *S3*
| 3.5 | Получение ПФ | Вернуть набор (или одну) сохраненных форм в виде *JSON*-объекта с ссылками на *S3* хранилище
| 4.1 | CRUD-методы для шаблонов ПФ | Запрос на создание / удаление / изменение шаблона ПФ
| 4.2 | CRUD-методы для шаблонов ПФ | Обращение в БД *PostgreSQL* для создание / удаление / изменение записи о шаблоне ПФ
| 4.3 | CRUD-методы для шаблонов ПФ | Вернуть результат операции в сервис печатных форм
| 4.4 | CRUD-методы для шаблонов ПФ | Вернуть результат клиенту
| 5.1 | Изменение статуса ПФ | Передача признака из *1С*:ДО того, что *GUID* создан или получен документ в *1С*:ДО
| 5.2 | Изменение статуса ПФ | Сохранение признака в БД *PostgreSQL*
| 5.3 | Изменение статуса ПФ | Вернуть результат операции
| 5.4 | Изменение статуса ПФ | Вернуть результат изменения статуса в *1С*:ДО
|===
****

== Доменная модель

.*В рамках доменной модели существуют 2 основные сущности:*
****
. Шаблон документа 
. Печатная форма (ПФ). 
****

=== Печатная форма

****
Запрос на создание печатной формы может поступить от любого приложения.
****

****
.Схема взаимодействия основных компонент
[[print_form_live_anchor]]
[%collapsible%open]
====
image::print_form_live.png[title="Схема взаимодействия основных компонент", align=center]
====
****

=== Шаблон документа

****
Может быть создан, отредактирован или удален только администратором.
****

****
.Схема взаимодействия основных компонент
[[print_template_live_anchor]]
[%collapsible%open]
====
image::print_template_live.png[title="Схема взаимодействия основных компонент", align=center]
====
****

====
IMPORTANT: Знаком icon:check-circle[role=green] отмечены активности которые *ВОЙДУТ* в MVP на МАРТ 2023 года!!! +
Знаком icon:minus-circle[role=red] отмечены активности которые *[red]#НЕ# ВОЙДУТ в* MVP на МАРТ 2023 года!!!
====

[[ONEROLF-FL-1]]
== Задачи решаемые модулем ONEROLF-FL-2 footnote:ONEROLF-FL-2[Документ в Confluence ROLF: [blue]#*MVP Функционал Продукта One Rolf + MDM + MES + WMS|TMS (Новая версия Ноябрь 2022)*#, Название модуля системы: [blue]#*ONEROLF-FL-2. Модуль Шаблоны и печатные формы*#] по работе с печатными формами

.*Функционал модуля:*
****
[.green.background]
====
. Шаблоны печатных форм общих документов:
* СОПД Рольф icon:check-circle[role=green]
* Печатные формы документов на оплату icon:check-circle[role=green] (В *MVP* - направления на оплату, Счет (безнал), квитанция для ККМ - остальное после MVP)
. Шаблоны печатных форм по направлениям:
* Печатные формы НА icon:check-circle[role=green] 
* Печатные формы АСПП icon:check-circle[role=green]
* Печатные формы АСПВ icon:check-circle[role=green]  
* Печатные формы Сервис icon:check-circle[role=green]
* Печатные формы F&I icon:check-circle[role=green] (ПФ калькулятора расчета + формы  документов продуктов страхования для МСК, для СПБ формы будут настраиваться после MVP)
* В рамках MVP будут настроены HTML шаблоны для ограниченного согласованного списка документов печатных форм с автозаполнением печатных форм данными из системы.icon:check-circle[role=green]
. Модуль управления и корректировка шаблонов печатных форм:
* Редактор шаблонов печатных форм icon:check-circle[role=green]
* Предпросмотр шаблонов печатных форм icon:check-circle[role=green]
====
[.red.background]
====
. Шаблоны печатных форм общих документов:

* СОПД Импортеров icon:minus-circle[role=red]
. Шаблоны печатных форм по направлениям:
* Печатные формы Fleet icon:minus-circle[role=red]
* Печатные формы Продажи ЗЧicon:minus-circle[role=red]
. Генератор печатных форм: icon:minus-circle[role=red]
* Визуализатор печатных форм icon:minus-circle[role=red]
* Динамическое формирование печатной формы документа в зависимости от выбранных опций в систем icon:minus-circle[role=red]
. Модуль управления и корректировка шаблонов печатных форм:
* Конструктор шаблонов печатных форм icon:minus-circle[role=red]
* Инструмент согласования изменения контента печатной формы icon:minus-circle[role=red]
. Групповая печать:icon:minus-circle[role=red]
* Правила пакетной печати icon:minus-circle[role=red]
* Мастер настройки пакетной печати icon:minus-circle[role=red]
====
****

.*Интеграции внешние и внутренние:*
****
[.red.background]
====
ГПФ icon:minus-circle[role=red]
====
****
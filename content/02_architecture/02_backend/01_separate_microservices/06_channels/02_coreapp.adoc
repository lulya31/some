---
title: "Канал coreapp"
description: "Канал coreapp"
weight: 2
draft: false
---

:imgdir: /02_02_01_06_02_img/
:imagesoutdir: ./static/02_02_01_06_02_img/

include::static/includes/init.adoc[]

:mermaid-puppeteer-config: ./themes/template/puppeteer-config.json

= Канал coreapp

{empty} +

== Описание канала coreapp

****
Дефиниции канала *corapp* предназначены для внутреннего использования и выполняют функции:
====
* Авторизации и аутентификации
* Взаимодействие фронт-энда и базы данных
* Интеграции с оперсистемами
* Другие
====
****

****
[cols=".^25h,.^75"]
|===
| Ссылка на канал | `*link:https://cc-coreapp.plf.int.rolfcorp.ru[window=_blank]*`
|===
****

****
[cols=".^25h,.^75"]
|===
| Ссылка на бизнес требования | `*link:/[Ссылка на бизнес требования, window=_blank]*`
|===
****

== Состав команды

****
[cols=".^40,.^30,.^30"]
|===
^.^| Ф.И.О. ^.^| Роль ^.^| Email

| Иванов И.И. | Разработчик | test@rolf.ru
|===
****

== Агрегаты и сущности

****
* *Объект-значение* - группировка нескольких атрибутов как единое целое, добавляя к ним определённое поведение.
* *Сущность* - Основное отличие *Сущности* от *Объекта-значения* — это идентификатор. У Сущностей есть идентификаторы. *Идентификатор* — это единственное свойство Сущностей, которое определяет уникальность каждой из них.
* *Агрегат* - объединение связанных сущностей, имеющих общий ограниченный контекст и набор бизнес-правил. Каждый агрегат имеет корневую сущность, т.е. объект через который осуществляется взаимодействие со всеми сущностями агрегата.
****

.Агрегат `[.red]#*Клиент (физическое лицо)*#` (*Clients*) описывает все физические лица, которые могут или являются клиентами и так или иначе учавствуют в сделках.
****
.Сущности включаемые в агрегат `[.red]#*Клиент (физическое лицо)*#`
[cols=".^30h,.^70"]
|===
^.^| Сущность ^.^| Описание

| *Физическое лицо (person)* | Сущность Физическое лицо (person) используется при необходимости в агрегате сделать ссылку на конкретное физическое лицо.
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *Дети (children)* | 
| *Адреса (addresses)* | Адреса (фактические и юридические). Могут относиться как к физическому лицу, так и к юридическим организациям.
| *Телефоны (telephones)* | Сущность описывает личные (не рабочие) телефоны физических лиц.
| *Документы (documents)* | Сущность описывает документы разных типов, принадлежащие физическим лицам (удостоверения личности (паспорт), доверенности и так далее).
| *СОПД (sopd)* | Сущность описывает существующие **С**оглашения об **О**бработке **П**ерсональных **Д**анных у клиента, а также общий статус согласия
| *Комментарии пользователей (comments)* | 
| *Банковские реквизиты (accounts)* | 
| *Дисконтные (скидочные) карты (discount_cards)* | 
| *Мессенджеры (messengers)* | 
| *Социальные сети (social_networks)* | 
|===
****

====
NOTE: Агрегаты `[.red]#*Пользователь*#`, `[.red]#*Сотрудник*#` наследуют данные от агрегата `[.red]#*Физическое лицо (клиент)*#`!
====

.Агрегат `[.red]#*Cотрудник*#` (*Employees*) описывает все физические лица, которые являются сотрудниками компании *ROLF*.
****
.Сущности включаемые в агрегат `[.red]#*Cотрудник*#`:
[cols=".^30h,.^70"]
|===
^.^| Сущность ^.^| Описание

| *Физическое лицо (person)* | Сущность Физическое лицо (person) используется при необходимости в агрегате сделать ссылку на конкретное физическое лицо.
| *HR данные (hr_data)* | 
| *Группы сотрудников (employee_group)* | 
| *Рассписание (schedule)* | 
| *Шаблон рассписания (schedule_template)* | 
| *Телефоны (telephones)* | Сущность описывает личные (не рабочие) телефоны физических лиц.
| *Рабочие телефоны (working_telephones)* | Сущность описывает рабочие телефоны физических лиц.
| *Электронная почта (emails)* | 
| *Документы (documents)* | Сущность описывает документы разных типов, принадлежащие физическим лицам (удостоверения личности (паспорт), доверенности и так далее).
| *Подчиненные (under_employees)* | 
| *Начальники (managers)* | 
|===
****

====
NOTE: Агрегат `[.red]#*Сотрудник*#` может наследовать данные от агрегата `[.red]#*Физическое лицо (клиент)*#`, так как любой сотрудник может также являться клиентом, то есть одним и тем же физическим лицом. +
Все методы для работы с данным агрегатом должны начинаться с `*/rolfid/v1/employees*`
====

.Агрегат `[.red]#*Пользователь*#` (*User*) описывает все физические лица, которые являются пользователями *Flora*. Пользователи обладают правами на просмотр и/или изменения информации. Данные права определяются через группы доступа, которые первоначально определены в *AD* и синхронизированы через *Keycloak*.
****
.Сущности включаемые в агрегат `[.red]#*Пользователь*#`:
[cols=".^30h,.^70"]
|===
^.^| Сущность ^.^| Описание

| *Физическое лицо (person)* | Сущность Физическое лицо (person) используется при необходимости в агрегате сделать ссылку на конкретное физическое лицо.
| *Группы пользователей (ad_groups)* | 
| *Телефоны (telephones)* | Сущность описывает личные (не рабочие) телефоны физических лиц.
| *Электронная почта (emails)* | 
|===
****

====
NOTE: Агрегат `[.red]#*Пользователь*#` может использует общие сущности *RolfID*. +
Все методы для работы с данным агрегатом должны начинаться с `*/rolfid/v1/users*`
====

.Агрегат `[.red]#*Автомобиль*#` (*vehicle*) описывает все физические лица, которые являются пользователями *Flora*. Пользователи обладают правами на просмотр и/или изменения информации. Данные права определяются через группы доступа, которые первоначально определены в *AD* и синхронизированы через *Keycloak*.
****
.Сущности включаемые в агрегат `[.red]#*Автомобиль*#`:
[cols=".^30h,.^70"]
|===
^.^| Сущность ^.^| Описание

| *Комплектация (equipment)* | 
| *Владелец (owner)* | 
| *Резерв (reserve)* | 
| *Гарантия (warranty)* | 
| *Отзывные компании (recall_campaign)* | 
| *Фото и видео (media)* | 
| *Документы (documents)* | Сущность описывает документы разных типов, принадлежащие физическим лицам (удостоверения личности (паспорт), доверенности и так далее).
| *Потребности (needs)* | 
| *Платежи (payments)* | 
| *Акты осмотра автомобиля (inspection)* | 
| *Элкетронные карты диагностики (ekd)* | 
| *История (history)* | 
| *Гос. номера (plate_numbers)* | 
| *Проверки (check)* | 
| *ТО и ремонт (service)* | 
| *Запрет выкупа (prohibition_of_redemption)* | 
| *Пробег (mileage)* | 
| *Диски и шины (wheels_and_tires)* | 
| *Диски (wheel)* | 
| *Шины (tires)* | 
|===
****

====
NOTE: Агрегат `[.red]#*Автомобиль*#` (*Vehicles*) описывает все транспортные средства, которые находятся в продаже или являются собственностью клиента и так или иначе учавствуют в сделках.
====

.Основные сущности, которые переиспользуются или наследуются для разных агрегатов:
****
[cols=".^30h,.^70"]
|===
^.^| Сущность ^.^| Описание

| *Страна (country)* | Объект *Страна* используется при необходимости в агрегате сделать ссылку на принадлежность к той или иной стране (например, для гражданста физического лица или регистрации юридического лица).
| *Физическое лицо (person)* | Сущность Физическое лицо (person) используется при необходимости в агрегате сделать ссылку на конкретное физическое лицо.
| *Телефоны (telephones)* | Сущность описывает личные (не рабочие) телефоны физических лиц.
| *Адреса (adresses)* | Адреса (фактические и юридические). Могут относиться как к физическому лицу, так и к юридическим организациям.
| *Электронная почта (emails)* | Сущность описывает личные адреса электронной почты.
| *Документы (documents)* | Сущность описывает документы разных типов, принадлежащие физическим лицам (удостоверения личности (паспорт), доверенности и так далее).
| *СОПД (sopd)* | Сущность описывает существующие **С**оглашения об **О**бработке **П**ерсональных **Д**анных у клиента, а также общий статус согласия
|===
****

== Базы данных

=== Структура базы данных

.Структура базы данных
****
[cols=".^30h,.^70"]
|===
^.^| Название таблицы ^.^| Описание

| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_filter_element_type_d, window=_blank]*` | Тип элемента фильтрации: `*match*`, `*multiselect*`, др. и дополнительная информация по ним
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_filter_elements_b, window=_blank]*` | Структура элемента фильтрации: имеет `*id*` (и/или name), `*title*` (заголовок), `*type*`, `*description*` (опционально)
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_filter_fields_b, window=_blank]*` | Структура поля фильтрации: `*id*` (`*UUID*`), `*name*`, `*title*` (заголовок для отображения в `*UX*`), description (описание для аналитиков при создании новых фильтров)
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_filter_elements_for_filter_fields_b, window=_blank]*` | Соответствие элементов фильтра и полей фильтра
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_web_views_b, window=_blank]*` | Перечень *web_views* - приложений баз данных (База клиентов, База пользователей, База авто на продажу, База клиентских авто, База Юр. Лиц и др.)
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_filter_fields_for_web_views_b, window=_blank]*` | Соответствие полей фильтра определенным `*web_view*` (приложению базы данных)
| `*link:https://doc-core-main.com-dev.int.rolfcorp.ru/02_info_model/10_datastorage/01_postgresql/01_flora_filters/[core_saved_filters, window=_blank]*` | (`*PostMVP*`) - таблица с сохраненными фильтрами (`*UUID*` + `*object*`)
|===
****

=== ERD-диаграмма

****
.*ERD Диаграмма (Отобразить/Скрыть)*
[%collapsible%open]
====
// [mermaid, width=5000, target=yandexcloud, background=#0000000F]
[mermaid, target=coreapp, format=svg, opts=interactive, align=center, width=100%]
....

erDiagram

    core_web_views_b }|--|{ core_filter_fields_for_web_views_b : core_web_views_b_uuid
    core_web_views_b {
        uuid core_web_views_b_uuid
        string title
        string name
        string description
    }
    core_filter_fields_for_web_views_b {
        uuid core_web_views_b_uuid
        uuid core_filter_fields_b_uuid
    }
    core_filter_elements_b }|--|| core_filter_element_type_d : core_filter_element_type_d_uuid
    core_filter_elements_b {
        uuid core_filter_elements_b_uuid
        string title
        uuid core_filter_element_type_d_uuid
        string description
        string filter_data_url
        float minValue
        date minValue_date
        float maxValue
        date maxValue_date
    }
    core_filter_element_type_d {
        uuid core_filter_element_type_d_uuid
        string name
        string code
        string datatype
        string description
    }
    core_filter_fields_b {
        uuid core_filter_fields_b_uuid
        string title
        string name
        string description
    }
    core_filter_fields_b }|--|{ core_filter_fields_for_web_views_b : core_filter_fields_b_uuid
    
    core_filter_elements_for_filter_fields_b }|--|{ core_filter_elements_b : core_filter_elements_b_uuid
    core_filter_elements_for_filter_fields_b }|--|{ core_filter_fields_b : core_filter_fields_b_uuid
    core_filter_elements_for_filter_fields_b {
        uuid core_filter_elements_for_filter_fields_b_uuid
        uuid core_filter_fields_b_uuid
        uuid core_filter_elements_b_uuid
    }
    core_saved_filters_b
....
====
****

== API

****
[cols=".^100h"]
|===
^.^| Ссылки на описания методов

| `*link:https://doc-orders-main.com-dev.int.rolfcorp.ru/03_methods/01_rest/[REST API-методы, window=_blank]*`
| `*link:https://doc-orders-main.com-dev.int.rolfcorp.ru/03_methods/02_shared_flow/[Shared flow методы, window=_blank]*`
| `*link:https://doc-orders-main.com-dev.int.rolfcorp.ru/03_methods/03_event_based/[Event based методы, window=_blank]*`
|===
****

== Сценарии

****
В разделе описана последовательность действий бизнес-логики, изменение состояний агрегатов и сущностей, а такэже привязка методов и существующих макетов экранных форм.
****

=== Бизнес-процессы

****
[cols=".^30h,.^70"]
|===
^.^| Краткое описание бизнес-процесса ^.^| Ссылка на подробное описание бизнес-процесса

| Краткое описание бизнес-процесса 1 | `*link:/[Бизнес-процесс 1, window=_blank]*`
| Краткое описание бизнес-процесса 2 | `*link:/[Бизнес-процесс 2, window=_blank]*`
|===
****

== Интеграции

****
Описание внешних (по отношению к каналу!) интеграций. Это могут быть другие сервисы, каналы, информационные системы и так далее. Должна быть приведена общая схема интеграции и примеры взаимодействия.
****

=== Внешние системы

****
Краткое описание внешних систем
****

****
[cols=".^30h,.^70"]
|===
^.^| Краткое описание системы ^.^| Ссылка на подробное описание системы

| Краткое описание системы 1 | `*link:/[Система 1, window=_blank]*`
| Краткое описание системы 2 | `*link:/[Система 2, window=_blank]*`
|===
****

=== Внутренние системы

****
Краткое описание внешних систем
****

****
[cols=".^30h,.^70"]
|===
^.^| Краткое описание системы ^.^| Ссылка на подробное описание системы

| Краткое описание системы 1 | `*link:/[Система 1, window=_blank]*`
| Краткое описание системы 2 | `*link:/[Система 2, window=_blank]*`
|===
****

== Технические решения

****
****

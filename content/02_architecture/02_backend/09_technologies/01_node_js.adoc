---
title: "Node JS"
description: "Node JS"
weight: 1
draft: false
---

:imgdir: /02_02_09_01_img/
:imagesoutdir: ./static/02_02_09_01_img/

include::static/includes/init.adoc[]

= Node JS

{empty} +

== Что такое Node.js

****
image:node_js_logo.png[100, 100, float="left"] *Node* или *Node.js* — программная платформа, основанная на движке *V8* (компилирующем *JavaScript* в машинный код), превращающая *JavaScript* из узкоспециализированного языка в язык общего назначения. *Node.js* добавляет возможность *JavaScript* взаимодействовать с устройствами ввода-вывода через свой *API*, написанный на *C++*, подключать другие внешние библиотеки, написанные на разных языках, обеспечивая вызовы к ним из *JavaScript*-кода. *Node.js* применяется преимущественно на сервере, выполняя роль веб-сервера, но есть возможность разрабатывать на *Node.js* и десктопные оконные приложения (при помощи *NW.js*, *AppJS* или *Electron* для *Linux*, *Windows* и *macOS*) и даже программировать микроконтроллеры (например, *tessel*, *low.js* и *Espruino*). В основе *Node.js* лежит событийно-ориентированное и асинхронное (или реактивное) программирование с неблокирующим вводом/выводом.
****

****
*Node.js* ― это не отдельный язык программирования, а среда для выполнения *JavaScript*. Или, другими словами, платформа для работы с *JavaScript* на стороне сервера. Раньше *JavaScript* мог выполнять только браузер. С помощью *Node.js* это можно делать без него.

{empty} +

Чаще всего *Node* используют для написания серверной части сайта (для неё он и был создан изначально), однако сейчас на нём пишут и десктопные программы. На данный момент эту технологию для своего бэкенда используют *PayPal*, *eBay*, *Amazon* и *Netflix*.

{empty} +

Платформу разработал *Райан Дал*, а спонсором разработки выступила компания *Joyent*. Среда была представлена в 2009 году. *Node.js* основана на движке *V8*. *V8* ― это программа, которая преобразует *JavaScript* в машинный код, то есть код понятный процессору. Этот же движок используется в основе браузера *Google Chrome*.

{empty} +

Одного *V8* для удобной работы мало, так как он может работать только с *JavaScript*. Он не умеет читать файлы, не может работать с сетью вне браузера, поэтому *Райан Дал* вместе с разработчиками с помощью дополнительных библиотек и кода добавили дополнительные возможности к *V8*. Это позволило сделать из *JavaScript* WEB-сервер.
****

.Плюсы *Node.js*:
****
====
* Использование одного языка *JavaScript* как на клиентской стороне в браузере, так и на сервере.
* *NPM* (*Node Package Manager*) ― это менеджер пакетов, или набор готовых модулей. Это своеобразный склад, где программисты делятся своим кодом. Комьюнити очень большое, поэтому в *NPM* на данный момент собрано огромное количество решений для разных задач.
* Увеличение скорости работы. *Node.js* ― это однопоточная и асинхронная система. Вы можете читать файлы, отправлять электронные письма, запрашивать данные и совершать другие действия одновременно. Подробнее об однопоточной работе мы расскажем ниже.
====
****

== Node.js основы: что такое многопоточная и однопоточная работа

****
При изучении серверных процессов нужно знать, что есть 2 схемы работы с сервером ― многопоточная и однопоточная.

{empty} +

Работа с *WEB*-приложением ― это передача запроса и получение ответа от сервера. Многопоточная система линейна. Вначале выполняется один запрос, затем другой и так далее по очереди. Например, нам нужно обратиться к базе данных. *WEB*-сервер делает запрос и ждёт, пока не придёт ответ. Как только ответ вернулся, он обрабатывает его и может приступить к отправке других запросов. Как видите, в процессе ожидания *WEB*-сервер тратит ресурсы, но ничего не делает.
****

****
.Многопоточная система
[[node_js_anchor]]
[%collapsible%open]
====
image::node_js.png[title="Многопоточная система", align=center, width="50%"]
====
****

****
При выполнении запроса потребляются ресурсы сервера: память, процессорное время и количество ядер. Получается, при многопоточном подходе сервер может выполнить только один запрос за раз? Нет. Каждый запрос помещается в отдельный поток. Поток ― это время и ресурсы, которые выделяет сервер для выполнения небольшого блока инструкций. Таким образом, количество потоков зависит от мощности машины. Чем больше ресурсов, тем больше потоков и тем больше запросов может выполнить сервер одновременно. Такая модель работы называется *thread-per-request model* (модель потока на запрос).
****

== Как работает Node.js?

****
*Node.js* работает по однопоточному принципу в рамках событийно-ориентированной модели. Его архитектура не блокирует ввод и вывод. При этом подходе:

====
* Все запросы обрабатываются в рамках одного потока
* *WEB*-сервер не тратит время на ожидание ответа
* *WEB*-сервер посылает запросы и обрабатывает ответы по мере их поступления
====

Таким образом, *WEB*-сервер всегда находится в работе, а не в процессе ожидания. Такой способ позволяет эффективно использовать ресурсы и выполнять команды намного быстрее.
****

****
.Однопоточная система
[[node_js_2_anchor]]
[%collapsible%open]
====
image::node_js_2.png[title="Однопоточная система", align=center, width="50%"]
====
****

****
Отличным примером является загрузка страницы сайта. Представьте, вы хотите загрузить страницу сайта. *WEB*-ресурс может показаться пользователю, как только браузер получит весь необходимый контент. При использовании обычного *WEB*-сервера с многопоточной системой каждый файл (картинка, название, основной текст, фон) будет запрашиваться по отдельности. Например, сначала фон, затем, как только данные фона будут получены, *WEB*-сервер отправит запрос на картинки и так далее. Из-за долгого ожидания ответа страница будет грузиться дольше. Как мы уже говорили *Node.js* не тратит время на ожидание. Во время поиска фоновой картинки нода запросит другую картинку. За счёт этого сайт загрузится быстрее.

{empty} +

Однопотоковая система работает благодаря циклу событий, который состоит из *6* фаз. Практически на каждой фазе выполняются коллбэки (обратные вызовы) — функции, которые срабатывают сразу после завершения работы предыдущих функций.
****

****
.Цикл событий *Node.js*
[[node_js_3_anchor]]
[%collapsible%open]
====
image::node_js_3.png[title="Цикл событий *Node.js*", align=center, width="50%"]
====
****

====
. *Таймеры* (`[.red]#timers#`). На этом этапе срабатывают коллбэки методов `[.red]#setInterval()#` и `[.red]#setTimeout()#`
. *Ожидающие обратные вызовы* (`[.red]#pending callbacks#`). В этой фазе срабатывает практически все коллбэки, отложенные в предыдущую фазу. Исключение — `[.red]#setImmediate(), close#` и таймеры
. *Ожидание и подготовка* (`[.red]#idle, prepare#`). Отвечает за внутренние цели
. *Опрос* (`[.red]#poll#`). Принимает новые события ввода/вывода
. *Проверка* (`[.red]#check#`). На этом этапе срабатывают коллбэки, вызванные методом `[.red]#setImmediate()#`
. *Закрытие* (`[.red]#close callbacks#`). Закрывает обратный вызов, например, `[.red]#socket.on('close', …)#`
====

****
Чаще всего платформу *Node* используют для создания *WEB*-сервисов, которые требуют интенсивного обмена информацией с пользователями, например, чатов, социальных сетей и подобных систем. Также *Node* хорошо подходит для разработки *RTA* — *WEB*-приложений, которые реагируют на действия пользователя в режиме реального времени. Например, онлайн-редакторов типа *Google Docs*, который позволяет работать над одним документом нескольким пользователям одновременно.
****

== Node.js модули

****
Любой сложный проект состоит из файлов с кодом. Благодаря файловой системе удобно структурировать проект, а также выносить нужные части для других проектов. Каждый файл в *Node.js* называется модуль.

{empty} +

Модуль можно подключить с помощью функции `[.red]#require()#`. В скобках нужно указать путь к файлу. Набор модулей уже обширен. Например, вы можете использовать модуль *Node.js PostgreSQL* для взаимодействия с базой данных.

{empty} +

Подробнее о встроенных модулях и их функциональности можно узнать в официальной документации.
****

== Node.js, PHP или Python?

****
*Node.js* не такой популярный как *PHP*. На *PHP* написаны такие *CMS* как *WordPress*, *Joomla*!, *Drupal*. И именно на этих системах управления работает большинство сайтов. Фреймворков для *PHP* пока больше, чем для *Node.js*. Инфраструктура ноды только начинает развиваться.
****

****
Популярными фреймворками для *Node* являются:
*AdonisJs*. Это фреймворк, который работает на всех основных операционных системах. Он обладает стабильной экосистемой для написания серверных *WEB*-приложений. Идеально подходит для разработчиков Laravel, которые пробуют переход на *Node.js*. +

{empty} +

*****
Особенности *AdonisJs*:
====
* Есть *ORM*, который помогает создавать безопасные *SQL*-запросы
* *API* и система аутентификации на основе сеансов
* Лёгкий в освоении конструктор запросов
* Высокая безопасность
* Поддержка баз данных *No-SQL*, таких как *MongoDB*
====
*****

*Express.js*. Это самый простой, гибкий и быстрый фреймворк *Node.js*. *Express.js* подходит для быстрой разработки простых приложений, так как имеет легкодоступные инструменты генерации *API*. +

{empty} +

*****
Особенности *Express.js*:
====
* Высокая настраиваемость
* Быстрое освоение программы
* Быстрая разработка на стороне сервера
* Поддерживает архитектуру *MVC*
* Поддержка *NoSQL*-баз данных из коробки
====
*****

*Koa.js*. Этот фреймворк был создан командой *Express.js*. Разработчики хотели учесть все недостатки *Express.js* и создать более совершенный продукт. Koa работает в разных браузерах, без использования обратных вызовов и обладает мощной системой обработки ошибок. Может использоваться для фронтенд- и бэкэнд-системы. +

{empty} +

*****
Особенности *Koa.js*:
====
* Встроенный *catchall* ошибок,
* Использование генераторов для управления и обработки обратных вызовов,
* Использует каскадную модель промежуточного ПО.
====
*****
****

****
Если сравнивать *Python* и *Node*, то их главное различие ― сфера применения. Нода подходит для *WEB*-разработки и некоторых десктопных программ, в то время как *Python* является универсальным решением. С его помощью можно сделать не только *WEB*-разработку, но и *Data Science*, *Machine Learning*.

{empty} +

Как проверить версию *Node.js*, если программа уже установлена? Зайдите в терминал и введите команду node `[.red]#-v#`. В результате вы увидите примерно такой вывод:
****

****
.Версия *Node.js*
[[node_js_4_anchor]]
[%collapsible%open]
====
image::node_js_4.png[title="Версия *Node.js*", align=center, width="50%"]
====
****
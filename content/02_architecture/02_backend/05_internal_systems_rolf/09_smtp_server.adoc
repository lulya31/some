---
title: "SMTP сервер"
description: "SMTP сервер"
weight: 8
draft: false
---

:imgdir: /02_02_05_09_img/
:imagesoutdir: ./static/02_02_05_09_img/

include::static/includes/init.adoc[]

= SMTP сервер

{empty} +

== Доступы SMTP

====
NOTE: В дальнейшем будет размещена информация о доступах к *SMTP* серверу(ам).
====

== SMTP сервер

****
*Simple Mail Transfer Protocol* (*SMTP*) — простой протокол связи, применяемый с целью пересылки электронных писем с сервера отправителя на сервер получателя. Этот протокол не рассчитан на обработку входящих сообщений, его используют для отправки и последующей доставки писем адресату. Преимущественно с помощью *SMTP* отправляют массовые и транзакционные рассылки.
****

****
Иногда протокол *SMTP* путают с IMAP или POP. Но между ними есть существенная разница. *SMTP* применяют для пересылки писем, тогда как POP или IMAP используют для обработки этих писем после получения.
****

****
.Схема отправки письма по протоколу *SMTP*
[[smtp_1_anchor]]
[%collapsible%open]
====
image::smtp_1.png[title="Схема отправки письма по протоколу *SMTP*", align=center]
====
****

****
*SMTP*-сервер — сервер, который работает по протоколу *SMTP*. Его главная задача — выступать ретранслятором (передатчиком) между серверами отправителя и адресата. Каждый *SMTP*-сервер обладает собственным адресом в формате `[.blue]#*smtp.serveraddress.com*#`. Это позволяет безошибочно определять нужный сервер при пересылке почты.
****

== Как происходит отправка почты через SMTP

****
Протокол *SMTP* работает по несложному набору правил:

====
* При отправке письма указывают отправителя и получателя.
* Сервер направляет запросы обеим сторонам, чтобы убедиться в их существовании.
* Сообщение передаётся по указанному адресу.
====

Функционал *SMTP* ограничивается доставкой писем. На стороне адресата электронное письмо извлекается с помощью *POP* и *IMAP*. +
Отправка писем по *SMTP* происходит через получение ответов на команды:

====
* *MAIL FROM* — адрес отправителя
* *RCPT TO* — адрес получателя
* *DATA* — содержание сообщения
====

Пошагово отправка письма по *SMTP* выглядит так:
====
. Сервер отправителя получает необходимую информацию и ищет сервер на стороне получателя, чтобы передать ему письмо: по email адресата определяет почтового провайдера и запрашивает *IP*-адрес *SMTP*-сервера получателя.
. Сервер выполняет соединение по порту *25* и передаёт письмо серверу получателя.
. При отсутствии ответа сервера со стороны получателя происходит ещё несколько попыток установить соединение. Если ответа нет, сервер отправителя вернёт ошибку отправки.
====

====
NOTE: Понять принцип работы *SMTP* просто, если представить себе почтальона, который забирает письмо у отправителя, находит правильный маршрут назначения и доставляет сообщение в почтовый ящик адресата.
====

Для работы по протоколу *SMTP* стандартно применяют *25* порт. Но во избежание спам-рассылок провайдеры могут закрыть к нему доступ. Тогда его заменяют дополнительными портами:
====
* *465* — применяют для создания защищенного *SSL*-соединения; 
* *587* — используют для предотвращения исходящего спама за счёт обязательной аутентификации отправителя.
====
****

== Какие типы SMTP-серверов существуют

****
Все *SMTP*-серверы условно разделяют на два типа:

====
* Обычные, предназначенные для отправки личной почты. Такие серверы чаще всего принадлежат провайдерам интернет-сетей, *Web*-хостингов либо электронной почты. Отличительная черта — ограничение по объёму писем. Обычно у каждого провайдера есть установленный дневной лимит.
* Выделенные серверы ретрансляции *SMTP*, применяемые для массовых рассылок и отправки транзакционных писем. Через эти серверы можно рассылать миллионы писем, не опасаясь блокировки *IP*.
====

Также *SMTP*-серверы можно классифицировать в зависимости от источника. Сервер для отправки писем могут предоставить:

====
* *Интернет-провайдеры.* Такой сервер не придется настраивать. Однако провайдеры обычно ограничивают количество писем и скорость отправки. Лимит писем, как правило, определяется тарифом.
* *Бесплатные почтовые сервисы.* Большинство почтовых сервисов разрешают отправку сообщений по *SMTP* — *Yandex*, *Gmail*, *Yahoo*. Для эксплуатации сервиса потребуется авторизация с паролем и логином аккаунта. В настройках почтового клиента необходимо указать порт и тип шифрования. Этим способом получится настроить сервер даже на мобильном телефоне. Однако лимиты достаточно малы для массовых рассылок — в среднем 150-500 писем в сутки.
* *Хостинг-провайдеры.* Располагая сайтом, можно воспользоваться сервером хостинга. Однако если с *IP*, который могут использовать несколько сотен сайтов, будет идти спам, почтовые службы заблокируют адрес. Если вы хотите получить полную управляемость, защиту от блокировок и выделенный *IP*, арендуйте у провайдера виртуальный *SMTP*-сервер (*VPS*).
* *Транзакционные email-сервисы.* Данные сервисы позволяют отправлять письма через *SMTP* с сайта, из *CRM*-системы или другого веб-приложения. Достаточно зарегистрировать учётную запись и указать в нужной системе сервис в качестве отправителя.
====

Выбор подходящего сервера обусловлен целями компании и масштабами деятельности. При небольшом количестве писем можно обойтись бесплатными вариантами или функционалом своего сайта. Для массовых рассылок, когда количество писем достигает нескольких сотен, тысяч или миллионов, стоит обратить внимание на виртуальные серверы и коммерческие сервисы транзакционных рассылок.
****

== Особенности применения SMTP

****
Несмотря на все плюсы *SMTP*-сервера, у него есть свои особенности, которые нужно учитывать:
====
* Ограничения со стороны провайдера. Провайдер может заблокировать порт *25* с целью предотвращения спам рассылок из своей сети.
* Проблемы с доставкой из-за грейлистинга. В процессе применения *SMTP* происходит множественный обмен запросами между серверами. Иногда сервер получателя перестаёт отзываться, подозревая спам. Включается автоматический фильтр спама (грейлистинг) и сервер отправителя прекращает попытки отправки. Вероятность грейлистинга нужно предусмотреть при настройке сервера. К примеру, в сервисах рассылок настраивают повторные отправки.
* Потребность в доработке. Для отправки рассылок через *SMTP*-сервер его в большинстве случаев нужно настраивать. Мониторинг открытий и переходов, настройка заголовков и трек-пикселей, оперативное исправление ошибок — всё это потребует участия разработчиков.
====
****
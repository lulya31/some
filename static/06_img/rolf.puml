@startuml C1

!include static/includes/c4_context.puml
!include static/includes/c4_container.puml
!include static/includes/c4_component.puml

skinparam backgroundcolor transparent
skinparam minClassWidth 200
skinparam linetype ortho

LAYOUT_LEFT_RIGHT()

/'
1. Линии сделать толстым и выделить разным цветом в зависимости от назначения:
2. обращение в БД (толстые синие линии)
3. REST-вызовы внутренние и от пользователей (толстые зеленые линии)
4. Асинхронное взаимодействие (kafka и - толстые зеленые линии
5. Отправка уведомлений (webscoket) - толстые оранжевые линии
6. Связь модулей (обычные линии, как сейчас)
7. HTTP-вызовы к внешним системам (толстые черные)
    8. Добавить легенду.
    9. Добавить еще внешние системы Рольф и связь с Internal Integration
    10. Добавить связь с оперсистемами (Oracle)
'/

AddRelTag("database", $textColor="blue", $lineColor="blue", $lineStyle=BoldLine())
AddRelTag("rest", $textColor="green", $lineColor="green", $lineStyle=BoldLine())
AddRelTag("async", $textColor="green", $lineColor="green", $lineStyle=BoldLine())
AddRelTag("webscoket", $textColor="orange", $lineColor="orange", $lineStyle=BoldLine())
AddRelTag("http", $textColor="black", $lineColor="black", $lineStyle=BoldLine())

System_Boundary(ext_systems1, "Внешние системы") {
    System_Ext(elt, "ELT", "", $sprite="img:./static/06_img/elt_logo.png{scale=0.75}")
    System_Ext(dadata, "", "", $sprite="img:./static/06_img/dadata_logo.png{scale=0.2}")
    System_Ext(tinkoff, "Tinkoff", "", $sprite="img:./static/06_img/tinkoff_logo.png{scale=0.25}")
    System_Ext(autoteka_ru, "Autoteka.ru", "", $sprite="img:./static/06_img/autoteka_ru.png{scale=0.4}")
    System_Ext(rosbank, "Rosbank", "", $sprite="img:./static/06_img/rosbank.png{scale=0.15}")
}

System_Boundary(ext_systems2, "Внешние системы") {    
    System_Ext(e_credit, "Е-кредит", "", $sprite="img:./static/06_img/e_credit.png{scale=0.25}")
    System_Ext(auto_ru, "Auto.ru", "", $sprite="img:./static/06_img/auto_ru.png{scale=0.2}")
    System_Ext(kia_myservice, "KIA MyService", "", $sprite="img:./static/06_img/kia_myservice.png{scale=0.075}")
    System_Ext(focus_kontur, "Контур Фокус", "", $sprite="img:./static/06_img/focus_kontur.png{scale=0.25}")
    System_Ext(sber, "Сбер", "", $sprite="img:./static/06_img/sber.png{scale=0.1}")
}

System_Boundary(rolf, "Рольф") {
    Person(user, "USER", "Пользователь")
    Person(admin, "ADMIN", "Администратор")

    System(flora, "FLORA", "", $sprite="img:./static/06_01_img/rolf_logo_2020.png{scale=0.2}", $link="/06_c4_infrastructure/01_flora/")

    System_Boundary(payments_acquiring, "Платежный эквайринг") {
        System(atol, "Atol", "", $sprite="img:./static/06_img/kkm.png{scale=1}")
        System(kkm, "ККМ", "", $sprite="img:./static/06_img/kkm.png{scale=1}")
        System(payment_gateway, "Платежный шлюз", "", $sprite="img:./static/06_img/payment_gateway.png{scale=1}")
        System(1c_rose, "1C Rose", "", $sprite="img:./static/06_img/1c.png{scale=1}")
    }

    System(erl, "ERL", "Единый рабочий лист", $sprite="img:./static/06_img/oracle.png{scale=1}")
    System(smtp_server, "SMTP Server", "", $sprite="img:./static/06_img/smtp_server.png{scale=1}")
    System(sms_gateway, "SMS Шлюз", "", $sprite="img:./static/06_img/sms_gateway.png{scale=1}")
    System(ad, "Active Directory", "", $sprite="img:./static/06_img/ad.png{scale=0.4}")
    System(1c_arms, "1С АРМС", "", $sprite="img:./static/06_img/1c.png{scale=1}")
    System(saphr, "", "", $sprite="img:./static/06_img/sap_hr_logo.png{scale=0.1}")
    System(wms, "", "", $sprite="img:./static/06_img/wms_logo.png{scale=0.5}")
    System(mdm, "MDM", "", $sprite="img:./static/06_img/mdm.png{scale=1}")

    System_Boundary(opersystems, "Оперсистемы") {
        System(fishblue, "FishBlue", "", $sprite="img:./static/06_img/oracle.png{scale=1}")
        System(is_storm, "ИС Шторм", "", $sprite="img:./static/06_img/oracle.png{scale=1}")
        System(as_rolf, "АС Рольф", "", $sprite="img:./static/06_img/oracle.png{scale=1}")
        System(as_rolf_insurance, "АС Рольф Страхование", "", $sprite="img:./static/06_img/oracle.png{scale=1}")
    }

    Rel(user, flora, "", $tags="rest")
    Rel(admin, flora, "", $tags="rest")

    BiRel_D(flora, atol, "")
    BiRel_D(flora, kkm, "")
    BiRel_D(flora, payment_gateway, "")
    BiRel_D(flora, 1c_rose, "")

    BiRel_D(flora, erl, "", $tags="database")
    BiRel_D(flora, smtp_server, "")
    BiRel_D(flora, sms_gateway, "")
    BiRel_D(flora, ad, "")

    BiRel_U(flora, 1c_arms, "")
    BiRel_U(flora, saphr, "")
    BiRel_U(flora, wms, "")
    BiRel_U(flora, mdm, "")
    BiRel_U(flora, fishblue, "", $tags="database")
    BiRel_U(flora, is_storm, "", $tags="database")
    BiRel_U(flora, as_rolf, "", $tags="database")
    BiRel_U(flora, as_rolf_insurance, "", $tags="database")
}

BiRel_D(flora, elt, "", $tags="http")
BiRel_R(flora, dadata, "", $tags="http")
BiRel_R(flora, tinkoff, "", $tags="http")
BiRel_R(flora, autoteka_ru, "", $tags="http")
BiRel_R(flora, rosbank, "", $tags="http")

BiRel_U(flora, e_credit, "", $tags="http")
BiRel_L(flora, auto_ru, "", $tags="http")
BiRel_L(flora, kia_myservice, "", $tags="http")
BiRel_L(flora, focus_kontur, "", $tags="http")
BiRel_L(flora, sber, "", $tags="http")

SHOW_LEGEND()

@enduml
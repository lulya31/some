@startuml Flora

!include static/includes/c4_context.puml
!include static/includes/c4_container.puml
!include static/includes/c4_component.puml

'!pragma layout elk

skinparam svgLinkTarget _blank
skinparam minClassWidth 200
skinparam wrapWidth 200
skinparam linetype ortho
'skinparam linetype polyline
skinparam backgroundColor transparent
'skinparam nodesep 150
'Skinparam Ranksep 150

LAYOUT_TOP_DOWN()

System(flora, "Flora", "Система Flora")

System_Boundary(core, "Общий функционал", "Общий функционал"){

    System(printservice, "Print service", "Печатные формы", $link="")
        System(pforms, "Print forms", "Печатные формы")

    System(carid, "Carid", "Транспортные средства", $link="")
        System(vehicles, "Vehicles", "Транспортные средства")
    
    System(clientid, "Clientid", "Клиенты (физлица и организации)", $link="")
        System(clients, "Клиенты")
        System(organizations, "Организации")

    System(coreapp, "Coreapp", "Комментарии, датагриды", $link="")
        System(comments, "Комментарии", "Комментарии", $link="")
        System(annotations, "Аннотации", "Аннотации", $link="")
        System(datagrid, "Датагриды", "Датагриды", $link="")

    System(payments, "Payments", "Платежи, чеки", $link="")
        System(payment, "Payment", "Платежи, чеки", $link="")
        
    System(needs_and_orders, "Needs and orders", "Обращения, потребности, предложения", $link="")
        System_Boundary(legalexecution, "Legal execution", "Legal execution"){
            System(legaldocuments, "Legal documents", "Юридические документы", $link="")
            System(legalevents, "Legal events", "Юридические события", $link="")
        }

        System(orders, "Orders", "Заказы", $link="")
        System(needs, "Needs", "Потребности", $link="")
        System(carts, "Пакет услуг", "Пакет услуг", $link="")

    System(communications, "Communications", "Коммуникации", $link="")
        System(communication, "Communications", "Коммуникации", $link="")
        System(requests, "Requests", "Запросы", $link="")

    System(tasks_and_events, "Tasks and events", "Задачи, события и оповещения", $link="")
        System(tasks, "Tasks", "Задачи", $link="")
        System(events, "Events", "События и оповещения", $link="")

    System(rolfid, "Rolfid", "Сотрудники, пользователи, ДЦ", $link="")
        System(users, "Users", "Пользователи", $link="")
        System(dealerships, "Dealerships", "ДЦ", $link="")
}

System_Boundary(experience, "Прикладные методы", "Прикладные методы"){
    System(services, "Service", "Сервис", $link="")
        System(service, "Service", "Сервис", $link="")
        System(mes, "MES", "Сервис", $link="")

    System(na, "NA Sale", "Продажа новых автомобилей", $link="")
    System(fi, "F&I", "F&I", $link="")
    System(asp, "ASP", "Продажа подержанных автомобилей", $link="")
        System(asp_sale, "ASP Sale", "Продажа автомобиля с пробегом", $link="")
        System(asp_buyout, "ASP Buyout", "Выкуп автомобиля с пробегом", $link="")
}

' Relations

Rel_U(flora, services, "")
    Rel_U(services, service, "")
    Rel_U(services, mes, "")

Rel_U(flora, na, "")
Rel_U(flora, fi, "")

Rel_U(flora, asp, "")
    Rel_U(asp, asp_sale, "")
    Rel_U(asp, asp_buyout, "")

Rel_D(flora, printservice, "")
    Rel_D(printservice, pforms, "")

Rel_D(flora, carid, "")
    Rel_D(carid, vehicles, "")

Rel_D(flora, clientid, "")
    Rel_D(clientid, clients, "")
    Rel_D(clientid, organizations, "")

Rel_D(flora, coreapp, "")
    Rel_D(coreapp, comments, "")
    Rel_D(coreapp, annotations, "")
    Rel_D(coreapp, datagrid, "")

Rel_D(flora, payments, "")
    Rel_D(payments, payment, "")

Rel_D(flora, needs_and_orders, "")
    Rel_D(needs_and_orders, legaldocuments, "")
    Rel_D(needs_and_orders, legalevents, "")
    Rel_D(needs_and_orders, orders, "")
    Rel_D(needs_and_orders, needs, "")
    Rel_D(needs_and_orders, carts, "")

Rel_D(flora, communications, "")
    Rel_D(communications, communication, "")
    Rel_D(communications, requests, "")

Rel_D(flora, tasks_and_events, "")
    Rel_D(tasks_and_events, tasks, "")
    Rel_D(tasks_and_events, events, "")

Rel_D(flora, rolfid, "")
    Rel_D(rolfid, users, "")
    Rel_D(rolfid, dealerships, "")

' Layout

Lay_D(services, flora)

Lay_D(flora, printservice)
    Lay_D(printservice, pforms)

Lay_D(flora, carid)
    Lay_D(carid, vehicles)

Lay_D(flora, clientid)
    Lay_D(clientid, clients)
    Lay_D(clientid, organizations)

Lay_D(pforms, coreapp)
    Lay_D(coreapp, comments)
    Lay_D(coreapp, annotations)
    Lay_D(coreapp, datagrid)

Lay_D(vehicles, payments)
    Lay_D(payments, payment)

Lay_D(comments, communications)
    Lay_D(communications, communication)
    Lay_D(communications, requests)

Lay_D(payment, tasks_and_events)
    Lay_D(tasks_and_events, tasks)
    Lay_D(tasks_and_events, events)

Lay_D(legaldocuments, rolfid)
    Lay_D(rolfid, users)
    Lay_D(rolfid, dealerships)

Lay_D(requests, needs_and_orders)
    Lay_D(needs_and_orders, legaldocuments)
    Lay_D(needs_and_orders, legalevents)
    Lay_D(needs_and_orders, orders)
    Lay_D(needs_and_orders, needs)
    Lay_D(needs_and_orders, carts)





/'
Lay_D(flora, rolfid)
Lay_D(flora, tasks_and_events)
Lay_D(flora, communications)
Lay_D(flora, needs_and_orders)

Lay_D(rolfid, payments)
Lay_D(tasks_and_events, coreapp)
Lay_D(communications, clientid)
Lay_D(needs_and_orders, carid)
'/

@enduml
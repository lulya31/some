@startuml C2

!include static/includes/c4_context.puml
!include static/includes/c4_container.puml
!include static/includes/c4_component.puml

skinparam backgroundcolor transparent
skinparam minClassWidth 200
skinparam linetype ortho

skinparam nodesep 50
'skinparam Ranksep 60

'LAYOUT_LEFT_RIGHT()
LAYOUT_TOP_DOWN()

System(rolf, "[System]", "", $sprite="img:./static/06_01_img/rolf_logo_2020.png{scale=0.2}", $link="/06_c4_infrastructure/")
System_Ext(external_systems, "External systems", "", $sprite="img:./static/06_01_img/external_integration.png{scale=0.1}")

System_Boundary(flora, "Система Flora", "Система Flora"){

    System_Boundary(frontend, "FrontEnd", "FrontEnd"){
        Container(asp_sell, "ASP sell", "VueJS, TypeScript", $sprite="img:./static/06_01_img/asp_sell.png{scale=0.15}")
        Container(crm, "", "VueJS, TypeScript", $sprite="img:./static/06_01_img/crm.png{scale=0.075}")
        Container(auto_card, "Auto card", "VueJS, TypeScript", $sprite="img:./static/06_01_img/auto_card.png{scale=0.1}")
        Container(client_card, "Client card", "VueJS, TypeScript", $sprite="img:./static/06_01_img/client_card.png{scale=0.25}")
        Container(employee_card, "Employee card", "VueJS, TypeScript", $sprite="img:./static/06_01_img/employee_card.png{scale=0.15}")
        Container(db_card, "DB card", "VueJS, TypeScript", $sprite="img:./static/06_01_img/db_card.png{scale=0.25}")
        Container(common_db_app, "Common DB app", "VueJS, TypeScript", $sprite="img:./static/06_01_img/common_db_app.png{scale=0.25}")
        Container(fi, "F&I", "VueJS, TypeScript", $sprite="img:./static/06_01_img/fi.png{scale=0.25}")
        Container(frontend_service, "Service", "VueJS, TypeScript", $sprite="img:./static/06_01_img/frontend_service.png{scale=0.25}")
    }

    Container_Boundary(infra, "Infrastructure", ""){
        Container(apim, "APIM", "", $sprite="img:./static/06_01_img/leroy_logo.png{scale=0.075}")
        Container(centrifugo, "Centrifugo (WSS)", "", $sprite="img:./static/06_01_img/centrifugo_soc.png{scale=0.075}")
        'Container(centrifugo, "Centrifugo (WSS)", "", $sprite="img:./static/06_01_img/logo_animated_no_accel.svg{scale=0.075}")
        Container(kafka, "Kafka", "", $sprite="img:./static/06_01_img/kafka_logo.png{scale=0.1}")
    }

    Container_Boundary(experience, "EXPERIENCE", "EXPERIENCE"){
        Container(service, "Service", "Platformeco", $sprite="img:./static/06_01_img/frontend_service.png{scale=0.25}")
        Container(f_and_i, "F&I", "Platformeco", $sprite="img:./static/06_01_img/fi.png{scale=0.25}", $link="https://doc-fi-main.com-dev.int.rolfcorp.ru/01_overview/02_architecture/01_c4_logic_scheme/")
        Container(asp_and_na, "ASP & NA", "Platformeco", $sprite="img:./static/06_01_img/asp_sell.png{scale=0.15}")
        Container(mes, "MES", "Platformeco", $sprite="img:./static/06_01_img/frontend_service.png{scale=0.25}")
    }

    Container_Boundary(core, "CORE", "CORE"){
        Container(orders, "Orders", "Platformeco", $sprite="img:./static/06_01_img/orders.png{scale=0.1}")
        Container(communications, "Communications", "Platformeco", $sprite="img:./static/06_01_img/communications.png{scale=0.3}")
        Container(coreapp, "Coreapp", "Platformeco", $sprite="img:./static/06_01_img/common_db_app.png{scale=0.25}")
        Container(task_and_events, "Task and Events", "Platformeco", $sprite="img:./static/06_01_img/task_and_events.png{scale=0.25}")
        Container(rolfid, "RolfID", "Platformeco", $sprite="img:./static/06_01_img/rolfid.png{scale=0.1}")
        Container(carid, "CarID", "Platformeco", $sprite="img:./static/06_01_img/carid.png{scale=0.3}")
        Container(clientid, "ClientID", "Platformeco", $sprite="img:./static/06_01_img/clientid.png{scale=0.1}")
        Container(mdm, "MDM", "Platformeco", $sprite="img:./static/06_01_img/mdm.png{scale=0.015}")
        Container(external_integration, "External Integration", "Platformeco", $sprite="img:./static/06_01_img/external_integration.png{scale=0.1}")
        Container(internal_integration, "Internal Integration", "Platformeco", $sprite="img:./static/06_01_img/internal_integration.png{scale=0.25}")
        Container(payments, "Payments", "Platformeco", $sprite="img:./static/06_01_img/payments.png{scale=0.15}")
        Container(printservice, "Print service", "NodeJS", $sprite="img:./static/06_01_img/printservice.png{scale=0.2}")
        Container(printformsanalize, "Print forms analize", "NodeJS", $sprite="img:./static/06_01_img/printformsanalize.png{scale=0.15}")
    }

    System_Boundary(infrastructure, "Infrastructure (DB, ETC)", "Infrastructure (DB, ETC)"){
        ContainerDb(postgresql, "", "", $sprite="img:./static/06_01_img/postgresql_logo.png{scale=0.4}")
        Container(s3_cep, "S3 Cep", "", $sprite="img:./static/06_01_img/s3_logo.png{scale=0.05}")
        ContainerDb(mongodb, "", "", $sprite="img:./static/06_01_img/mongodb_logo.png{scale=0.1}")
        Container(opensearch, "", "", $sprite="img:./static/06_01_img/opensearch_logo.png{scale=0.1}")
        Container(keycloak, "Keycloak", "", $sprite="img:./static/06_01_img/keycloak_logo.png{scale=0.2}")
        Container(grafana, "", "", $sprite="img:./static/06_01_img/grafana_logo.png{scale=0.05}")
    }
    
    Lay_D(employee_card, centrifugo)
    Lay_D(db_card, apim)
    Lay_D(fi, kafka)

    Lay_D(kafka, f_and_i)
    Lay_D(apim, asp_and_na)
    Lay_D(centrifugo, mes)
    Lay_D(mes, service)

    Lay_D(f_and_i, rolfid)
    Lay_D(asp_and_na, communications)
    Lay_D(service, orders)

    Lay_D(orders, mdm)
    Lay_D(communications, external_integration)
    Lay_D(coreapp, internal_integration)
    Lay_D(task_and_events, payments)
    Lay_D(rolfid, printservice)
    Lay_D(carid, printformsanalize)


    Lay_D(printformsanalize, grafana)
    Lay_D(mdm, postgresql)
    Lay_D(printservice, opensearch)
    Lay_D(internal_integration, s3_cep)
    Lay_D(external_integration, keycloak)
    Lay_D(payments, mongodb)

    BiRel_U(common_db_app, client_card, "")
    BiRel_U(common_db_app, crm, "")
    BiRel_U(common_db_app, auto_card, "")
    BiRel_U(common_db_app, asp_sell, "")
    BiRel_D(common_db_app, employee_card, "")
    BiRel_D(common_db_app, frontend_service, "")
    BiRel_D(common_db_app, fi, "")
    BiRel_D(common_db_app, db_card, "")

    BiRel_U(apim, frontend, "")
    BiRel_D(apim, experience, "")
    BiRel_D(apim, core, "")

    Rel(kafka, core, "")
    Rel(kafka, experience, "")

    BiRel(orders, opensearch, "")
    BiRel(communications, opensearch, "")
    BiRel(coreapp, opensearch, "")
    Rel(mes, service, "")
    BiRel(printservice, s3_cep, "")
    BiRel(f_and_i, opensearch, "")
    BiRel(rolfid, opensearch, "")
    BiRel(carid, opensearch, "")
    BiRel(clientid, opensearch, "")

    BiRel(postgresql, core, "")

    Rel_U(centrifugo, frontend, "")
    BiRel(centrifugo, task_and_events, "")
    BiRel_U(keycloak, rolfid, "")
}

Lay_D(external_integration, external_systems)
'Lay_D(rolf, auto_card)
Rel_D(rolf, flora, "")

Lay_D(flora, external_systems)
BiRel_D(external_integration, external_systems, "")

@enduml